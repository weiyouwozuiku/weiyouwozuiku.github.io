---
title: 计算机网络
author: 不二
mathjax: true
date: 2021-01-05 16:43:05
tags: 计算机网络
img:
categories: 计算机基础
---

![](https://cdn.jsdelivr.net/gh/weiyouwozuiku/buerlog_img/BlogImage/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C_%E7%BD%91%E7%BB%9C%E9%80%9A%E8%AE%AF%E5%8D%8F%E8%AE%AE%E5%85%B3%E7%B3%BB%E5%9B%BE2020%E7%89%88.png)

![](https://cdn.jsdelivr.net/gh/weiyouwozuiku/buerlog_img/BlogImage/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C_TCP-IP%E5%8D%8F%E8%AE%AE%E5%85%B3%E7%B3%BB%E5%9B%BE.png)

![](https://cdn.jsdelivr.net/gh/weiyouwozuiku/buerlog_img/BlogImage/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C_%E6%95%B0%E6%8D%AE%E6%A0%BC%E5%BC%8F.png)

## TCP与UDP

#### TCP

特点：

- 面向连接的、可靠的、基于字节流的传输层通信协议
- 将应用层的数据流分割成报文段并发送给目标节点的TCP层
- 数据包都有序号，对方收到则发送ACK确认，未收到则重传
- 使用校验和来校验数据在传输过程中是否有误

无论是TCP还是UDP都是不包含IP地址的（由TCP/IP负责），包含双方的端口号（标识进程）。

![](https://cdn.jsdelivr.net/gh/weiyouwozuiku/buerlog_img/BlogImage/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C_TCP%E6%8A%A5%E5%A4%B4.jpg)

- 16位源端口号和16位目的端口号；
- 32位序号：一次TCP通信过程中某一个传输方向上的字节流的每个字节的编号，通过这个来确认发送的数据有序，比如现在序列号为500，发送了200，下一个序列号就是700；
- 32位确认号：用来响应TCP报文段，给收到的TCP报文段的序号加1，三握时还要携带自己的序号；
- 4位头部长度：标识该TCP头部有多少个4字节，共表示最长15*4=60字节。同IP头部；
- 6位保留。6位标志。URG（紧急指针是否有效）ACK（表示确认号是否有效）PSH（提示接收端应用程序应该立即从TCP接收缓冲区读走数据）RST（表示要求对方重新建立连接）SYN（同步序号，表示请求建立一个连接）FIN（表示通知对方本端要关闭连接，用于释放连接）；
- 16位窗口大小：TCP流量控制的一个手段，用来告诉对端TCP缓冲区还能容纳多少字节；
- 16位校验和：由发送端填充，接收端对报文段执行CRC算法以检验TCP报文段在传输中是否损坏；
- 16位紧急指针：一个正的偏移量，它和序号段的值相加表示最后一个紧急数据的下一字节的序号；

##### 三次握手

![](https://cdn.jsdelivr.net/gh/weiyouwozuiku/buerlog_img/BlogImage/%E4%B8%89%E6%AC%A1%E6%8F%A1%E6%89%8B%E8%BF%9E%E6%8E%A5.png)

三次握手的必要性：

- 为了初始化Seq，用于之后的传输；

SYN Flood攻击：在首次握手时SYN超时，此时，Server不断重试直到超时，Linux默认重试五次，每次时间翻倍，起始时间从1秒开始，等待1+2+4+8+16+32=63秒才断开连接。使得服务器可能遭到SYN Flood攻击。**针对这种情况，SYN队列满了，通过tcp_syncookies参数回发SYN cookie。若为正常连接则Client会回发SYN cookie,直接建立连接。**

在建立连接之后，Ckient故障，采用**保活机制**。此时向对方发送保活机制探测报文，如果未收到响应则继续发送，直至尝试次数达到保活探测数的上限。此时认定该Client不可达，中断连接。

##### 四次挥手

![](https://cdn.jsdelivr.net/gh/weiyouwozuiku/buerlog_img/BlogImage/%E5%9B%9B%E6%AC%A1%E5%9B%9E%E6%94%B6%E5%85%B3%E9%97%AD.png)

TIME_WAIT状态的含义：

- 确保有足够的时间让对方收到ACK包，避免发生重传；
- 避免新旧连接混淆；

服务端大量出现CLOSE_WAIT状态的原因：对方关闭socket连接，我方忙于读写，没有及时关闭连接。此时，**检查代码，特别是释放资源的代码。检查配置，特别是处理请求的线程配置。**

Linux查看CLOSE_WAIT命令：`netstat -n | awk '/^tcp/ {++S[$NF]} END {for(a in S) print a, S[a]}'`。

##### 滑动窗口

RTT：发送一个数据包到收到对应的ACK所花费的时间

RTO：重传时间间隔

TCP使用滑动窗口做流量控制与乱序重排，保证TCP的可靠性与流控特性。

![](https://cdn.jsdelivr.net/gh/weiyouwozuiku/buerlog_img/BlogImage/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C_TCP%E5%8F%91%E9%80%81%E7%AA%97%E5%8F%A3.jpg)

滑动窗口的数据由两部分构成：已发送但是没有收到ACK的和允许发送还没发送的。

![](https://cdn.jsdelivr.net/gh/weiyouwozuiku/buerlog_img/BlogImage/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C_TCP%E6%8E%A5%E6%94%B6%E7%AA%97%E5%8F%A3.png)

接收窗口：已接受到没发ACK的

#### UDP

无论是TCP还是UDP都是不包含IP地址的（有TCP/IP负责），包含双方的端口号（标识进程）。

特点：

- 面向非连接
- 不维护连接状态，支持同时向多个客户端传输相同的信息
- 数据包报头只有8字节，额外开销小
- 吞吐量只受限于数据生成速率、传输速率与机器性能
- 尽最大努力交付，不保证可靠交付，不需要维护复杂的链接状态表
- 面向报文，不对应用程序提交的报文信息进行拆分或者合并

![](https://cdn.jsdelivr.net/gh/weiyouwozuiku/buerlog_img/BlogImage/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C_UDP%E6%8A%A5%E6%96%87.png)

### 二者区别

| tcp    | udp    |
| ------ | ------ |
| 连接   | 无连接 |
| 可靠   | 不可靠 |
| 有序   | 无序   |
| 速度慢 | 速度快 |
| 重量   | 轻量   |

## HTTP

特点：

- 支持客户端/服务器模式
- 简单灵活快速
- 灵活
- 无连接，长连接是由下层实现的对HTTP透明
- 无状态

HTTP1.1相较于HTTP1.0最大的区别就是引入长连接。

![](https://cdn.jsdelivr.net/gh/weiyouwozuiku/buerlog_img/BlogImage/HTTP%E8%AF%B7%E6%B1%82%E7%BB%93%E6%9E%84.png)

 在浏览器输入url后经历的流程：

1. DNS解析url对应的IP地址，由近到远的DNS解析为浏览器缓存、系统缓存、路由器缓存、ISP缓存、域名服务器缓存、顶级域名服务器缓存；
2. TCP连接
3. 发送HTTP请求
4. 服务器处理请求并返回HTTP报文
5. 浏览器解析渲染页面
6. 连接结束

### 状态码

五种可能的取值：

- 1xx：只是信息——表示请求已接收，继续处理
- 2xx：成功——表示请求已经被成功接收、理解
- 3xx：重定向——要完成请求必须进行进一步的操作
- 4xx：客户端错误——请求有语法错误或请求无法实现
- 5XX：服务端错误——服务器未能实现合法的请求

##### 常见状态码



## Tip

### Websocket

### 127.0.0.1&0.0.0.0.0

众所周知，$IP=<Network-ID>,<Host-ID>$。IP地址一共分为5位。

大致分类如下：

1. A类地址：网络号占1个字节，网络号的第一位固定为0;
2. B类地址：网络号占2个字节，网络号的前两位固定为10；
3. C类地址：网络号占3个字节，网络号的前三位固定位110；
4. D类地址：前四位是1110，用于多播\(multicast\)，即一对多通信；
5. E类地址：前四位是1111，保留为以后使用。

![](https://cdn.jsdelivr.net/gh/weiyouwozuiku/buerlog_img/BlogImage/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C_IP%E5%9C%B0%E5%9D%80%E5%88%86%E7%B1%BB.png)

其中，ABC三类地址为单播地址（unicast),用于一对一通信，是最常用的。

![](https://cdn.jsdelivr.net/gh/weiyouwozuiku/buerlog_img/BlogImage/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C_IP%E5%9C%B0%E5%9D%80%E5%88%92%E5%88%86.jpg)

### netstat

命令参数：

- -a或–all 显示所有连线中的Socket。
- -A<网络类型>或–<网络类型> 列出该网络类型连线中的相关地址。
- -c或–continuous 持续列出网络状态。
- -C或–cache 显示路由器配置的快取信息。
- -e或–extend 显示网络其他相关信息。
- -F或–fib 显示FIB。
- -g或–groups 显示多重广播功能群组组员名单。
- -h或–help 在线帮助。
- -i或–interfaces 显示网络界面信息表单。
- -l或–listening 显示监控中的服务器的Socket。
- -M或–masquerade 显示伪装的网络连线。
- -n或–numeric 直接使用IP地址，而不通过域名服务器。
- -N或–netlink或–symbolic 显示网络硬件外围设备的符号连接名称。
- -o或–timers 显示计时器。
- -p或–programs 显示正在使用Socket的程序识别码和程序名称。
- -r或–route 显示Routing Table。
- -s或–statistice 显示网络工作信息统计表。
- -t或–tcp 显示TCP传输协议的连线状况。
- -u或–udp 显示UDP传输协议的连线状况。
- -v或–verbose 显示指令执行过程。
- -V或–version 显示版本信息。
- -w或–raw 显示RAW传输协议的连线状况。
- -x或–unix 此参数的效果和指定”-A unix”参数相同。
- –ip或–inet 此参数的效果和指定”-A inet”参数相同。

ESTABLISHED 表示正在通信，TIME_WAIT 表示主动关闭，CLOSE_WAIT 表示被动关闭。

### awk

行匹配语句 awk '' 只能用单引号。

log.txt文本内容如下：

```txt
2 this is a test
3 Are you like awk
This's a test
10 There are orange,apple,mongo
```

```
# 每行按空格或TAB分割，输出文本中的1、4项，每项之间用空格分开
 $ awk '{print $1,$4}' log.txt
 ---------------------------------------------
 2 a
 3 like
 This's
 10 orange,apple,mongo
 # 格式化输出
 $ awk '{printf "%-8s %-10s\n",$1,$4}' log.txt
 ---------------------------------------------
 2        a
 3        like
 This's
 10       orange,apple,mongo
```

-F <可以指定标识符>